<!DOCTYPE html>
<html>
<head>
  <base target="_top">

  <style>
    /* ===== BASE ===== */
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      padding: 24px;
      color: #202124;
      background: #fff;
      counter-reset: page;
    }

    h2 {
      text-align: center;
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    h3 {
      background: #eee;
      padding: 8px;
      margin-top: 20px;
      margin-bottom: 5px;
      font-size: 16px;
      border-radius: 4px;
      border-left: 5px solid #1a73e8;
    }

    .empty-row td {
      height: 28px;
      border: 1px solid #ddd;
    }

    /* ===== ACTION BAR ===== */
    .no-print {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 14px;
    }

    .print-btn {
      background: #1a73e8;
      color: #fff;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }

    .print-btn.secondary {
      background: #f1f3f4;
      color: #202124;
    }

    /* ===== TABLE ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
      vertical-align: top;
      word-break: break-word;
    }

    th {
      background: #f2f2f2;
      font-weight: 600;
    }

    tr:nth-child(even) { background: #fafafa; }
    tr { page-break-inside: avoid; }

    /* ===== INVENTORY COLUMNS ===== */
    .col-hand, .col-left {
      text-align: center;
      font-weight: 600;
    }
    
    .col-hand {
      background: #e3f2fd !important;
      color: #1565c0;
    }

    .col-hand.low-stock {
      background: #FF6B6B !important;
      color: #fff;
    }
    
    .col-left {
      background: #fff3e0 !important;
      color: #e65100;
    }
    
    th.col-hand {
      background: #bbdefb !important;
    }
    
    th.col-left {
      background: #ffe0b2 !important;
    }

    /* ===== PRINT STYLES ===== */
    @media print {
      .no-print { display: none !important; }
      body { padding: 0; margin-bottom: 1cm; }
      table { font-size: 11px; }
      th { background: #eee !important; -webkit-print-color-adjust: exact; }
      
      th.col-hand { background: #bbdefb !important; -webkit-print-color-adjust: exact; }
      th.col-left { background: #ffe0b2 !important; -webkit-print-color-adjust: exact; }
      td.col-hand { background: #e3f2fd !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      td.col-hand.low-stock { background: #FF6B6B !important; color: #fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      td.col-left { background: #fff3e0 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }

      h3 { 
        -webkit-print-color-adjust: exact; 
        border-left: 5px solid #000;
      }

      .print-footer-fixed {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 100%;
        text-align: right;
        font-size: 10px;
        font-weight: bold;
        background: white;
        padding: 5px 0;
      }

      .page-number::after {
        counter-increment: page;
        content: "Page " counter(page);
      }
    }
  </style>
</head>

<body>

  <div class="no-print">
    <button class="print-btn secondary" onclick="window.close()">âœ– Close</button>
    <button class="print-btn" onclick="window.print()">ðŸ–¨ Confirm Print</button>
  </div>

  <div class="print-footer-fixed no-print-screen">
    Documentation - <span class="page-number"></span>
  </div>

  <div style="text-align: center; border-bottom: 2px solid #202124; margin-bottom: 20px; padding-bottom: 10px;">
    <h2 style="margin: 0; font-size: 24px; text-transform: uppercase;">Pending Fulfillment List</h2>
    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 13px; font-weight: 600;">
      <span>Date: <?= new Date().toLocaleDateString() ?> | Time: <?= new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) ?></span>
      <span>Employee ID: <span style="color: #1a73e8;"><?= employeeId ?></span></span>
    </div>
  </div>

  <? if (ebayItems.length > 0) { ?>
    <h3>eBay Items (<?= ebayItems.length ?> items)</h3>
    <table id="ebay-table">
      <thead>
        <tr>
          <th style="width: 13%">SKU</th>
          <th style="width: 5%">Qty</th>
          <th style="width: 9%">Location</th>
          <th style="width: 20%">Sales Order</th>
          <th style="width: 15%">Note</th>
          <th style="width: 10%">Status</th>
          <th style="width: 7%" class="col-hand">â—« HAND</th>
          <th style="width: 7%" class="col-left">â—© LEFT</th>
        </tr>
      </thead>
      <tbody>
        <? for (var i = 0; i < ebayItems.length; i++) { ?>
          <tr>
            <td><?= ebayItems[i][0] ?></td>
            <td style="text-align: center; font-weight: 600;"><?= ebayItems[i][1] ?></td>
            <td style="font-weight: 600; font-family: monospace;"><?= ebayItems[i][2] ?></td>
            <td><?= ebayItems[i][3] ?></td>
            <td><?= ebayItems[i][4] ?></td>
            <td><?= ebayItems[i][5] ?></td>
            <td class="col-hand<?= (parseFloat(ebayItems[i][6]) <= 20) ? ' low-stock' : '' ?>"><?= ebayItems[i][6] ?></td>
            <td class="col-left"><?= ebayItems[i][7] ?></td>
          </tr>
        <? } ?>
      </tbody>
    </table>
    
    <? if (directItems.length > 0) { ?>
      <div style="page-break-after: always;"></div>
    <? } ?>
    <? } ?>

  <? if (directItems.length > 0) { ?>
    <h3>DIRECT Items (<?= directItems.length ?> items)</h3>
    <table id="direct-table">
      <thead>
        <tr>
          <th style="width: 13%">SKU</th>
          <th style="width: 5%">Qty</th>
          <th style="width: 9%">Location</th>
          <th style="width: 20%">Sales Order</th>
          <th style="width: 15%">Note</th>
          <th style="width: 10%">Status</th>
          <th style="width: 7%" class="col-hand">â—« HAND</th>
          <th style="width: 7%" class="col-left">â—© LEFT</th>
        </tr>
      </thead>
      <tbody>
        <? for (var i = 0; i < directItems.length; i++) { ?>
          <tr>
            <td><?= directItems[i][0] ?></td>
            <td style="text-align: center; font-weight: 600;"><?= directItems[i][1] ?></td>
            <td style="font-weight: 600; font-family: monospace;"><?= directItems[i][2] ?></td>
            <td><?= directItems[i][3] ?></td>
            <td><?= directItems[i][4] ?></td>
            <td><?= directItems[i][5] ?></td>
            <td class="col-hand<?= (parseFloat(directItems[i][6]) <= 20) ? ' low-stock' : '' ?>"><?= directItems[i][6] ?></td>
            <td class="col-left"><?= directItems[i][7] ?></td>
          </tr>
        <? } ?>
      </tbody>
    </table>
  <? } ?>

  <!-- Summary Footer -->
  <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
    <div>
      <strong>Total Items:</strong> <?= ebayItems.length + directItems.length ?>
      <span style="margin-left: 20px;"><strong>eBay:</strong> <?= ebayItems.length ?></span>
      <span style="margin-left: 20px;"><strong>Direct:</strong> <?= directItems.length ?></span>
    </div>
    <div style="font-size: 11px; color: #666;">
      Generated: <?= new Date().toLocaleString() ?>
    </div>
  </div>

  <script>
    // Fill remaining page space with empty bordered rows
    // Uses fixed rows-per-page to avoid pixel miscalculation//
    function fillTableToPage(tableId, isFirstSection) {
      var table = document.getElementById(tableId);
      if (!table) return;

      var COL_COUNT = 8;

      // Rows that fit per page (A4, default margins, 11px print font)
      // First page of eBay table: has document header + h3 + table header = fewer rows
      // First page of DIRECT table: has h3 + table header (no doc header)
      // Continuation pages: just table header repeats
      var FIRST_PAGE_WITH_HEADER = 18;  // eBay first page (doc header + h3 + thead)
      var FIRST_PAGE_NO_HEADER = 21;    // DIRECT first page (h3 + thead only)
      var CONTINUATION_PAGE = 24;       // Any overflow pages

      var dataRows = table.querySelectorAll('tbody tr').length;
      var firstPageRows = isFirstSection ? FIRST_PAGE_WITH_HEADER : FIRST_PAGE_NO_HEADER;

      // Calculate how many rows are on the last page
      var rowsOnLastPage;
      if (dataRows <= firstPageRows) {
        rowsOnLastPage = dataRows;
        var pageCapacity = firstPageRows;
      } else {
        var overflow = dataRows - firstPageRows;
        rowsOnLastPage = overflow % CONTINUATION_PAGE;
        if (rowsOnLastPage === 0) rowsOnLastPage = CONTINUATION_PAGE;
        var pageCapacity = CONTINUATION_PAGE;
      }

      // Fill remaining space on the last page
      var emptyRows = pageCapacity - rowsOnLastPage;
      if (emptyRows <= 0) return;

      var tbody = table.querySelector('tbody');
      for (var i = 0; i < emptyRows; i++) {
        var tr = document.createElement('tr');
        tr.className = 'empty-row';
        for (var j = 0; j < COL_COUNT; j++) {
          var td = document.createElement('td');
          td.innerHTML = '&nbsp;';
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
    }

    window.onload = function () {
      fillTableToPage('ebay-table', true);    // First section (has doc header)
      fillTableToPage('direct-table', false);  // Second section (new page, no doc header)
      setTimeout(function () {
        window.print();
      }, 500);
    };
  </script>

</body>
</html>
